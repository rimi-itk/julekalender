{% macro _declaration(config, property, key=null) %}
{% autoescape false %}
{%- if config[key|default(property)] is defined -%}
  {{ property }}: {{ config[key|default(property)] }};
{%- endif -%}
{% endautoescape %}
{% endmacro %}

{% macro declaration(property, value) %}
{% autoescape false %}
{% if not value is null %}
  {{ property }}: {{ value }};
{% endif %}
{% endautoescape %}
{% endmacro %}

{% macro style(declarations) %}
	{% for property, value in declarations %}
   {{ _self.declaration(property, value) }}
	{% endfor %}
{% endmacro %}

{% autoescape false %}
{% if calendar.image.name|default(false) %}
{% set background_image = 'url(' ~ ((images_base_url ~ calendar.image.name)|json_encode(constant('JSON_UNESCAPED_SLASHES'))) ~ ')' %}
.calendar {
  background-image: {{ background_image }};
  width: {{ calendar.image.dimensions[0] }}px;
  height: {{ calendar.image.dimensions[1] }}px;
}
.door__face--front {
  background-image: {{ background_image }};
}
{% endif %}

{% for scene in calendar.scenes %}
{% set config = scene.configurationAsArray %}
.scene:nth-child({{ loop.index }}) {
	{{ _self.style(config.style|merge({
	left: config.x|default(null),
	top: config.y|default(null),
	width: config.width|default(null),
	height: config.height|default(null)
	})) }}
}

.scene:nth-child({{ loop.index }}) .door__face--front {
  background-position: -{{ config.x|default(0) }} -{{ config.y|default(0) }};
}

.scene:nth-child({{ loop.index }}) .content {
{% if scene.image.name|default(false) %}
	{% set background_image = 'url(' ~ ((images_base_url ~ scene.image.name)|json_encode(constant('JSON_UNESCAPED_SLASHES'))) ~ ')' %}
	{{ _self.style({
		'background-image': background_image,
		'background-repeat': 'no-repeat',
		'background-position': 'center center',
		'background-size': 'contain',
	}) }}
{% endif %}
{% if config.content.style|default(false) %}
	{{ _self.style(config.content.style) }}
{% endif %}
}

{% endfor %}
{% endautoescape %}
